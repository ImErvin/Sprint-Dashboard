/* Copyright (c) Ericsson 2019 */

define("widgets/utils/keyboardUtils",[],function(){"use strict";var e={},t={BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,ARROW_LEFT:37,ARROW_UP:38,ARROW_RIGHT:39,ARROW_DOWN:40,DELETE:46},i=function(t,i){var n,s=t.originalEvent.keyCode;if(Object.keys(i).some(function(t){if(e[t.toUpperCase()]===s)return n=i[t],!0}),n)return n(t)},n=function(e,t){if(!e||!t)throw new Error("Missing event argument");return e.addEventHandler("keydown",function(e){return i(e,t)})},s=function(e,t){t&&e.removeEventHandler(t)};return Object.keys(t).forEach(function(i){Object.defineProperty(e,i,{value:t[i],writable:!1})}),e.addKeyHandler=n,e.removeKeyHandler=s,e}),define("template!widgets/Tree/tree/Item/_item.html",["jscore/handlebars/handlebars"],function(e){return e.template(function(e,t,i,n,s){function o(e,t){return" ebTreeItem_expandable"}function r(e,t){var n,s="";return s+='\n        <div class="ebTreeItem-checkbox">\n            <input class="ebCheckbox" type="checkbox"/>\n            <span class="ebCheckbox-inputStatus ',n=i.if.call(e,(n=e&&e.item,n=null==n||n===!1?n:n.checkbox,null==n||n===!1?n:n._triple),{hash:{},inverse:u.noop,fn:u.program(4,h,t)}),(n||0===n)&&(s+=n),s+='"></span>\n        </div>\n        '}function h(e,t){return"ebCheckbox-inputStatus_triple"}function l(e,t){var i,n="";return n+='\n        <div class="ebTreeItem-icon">\n            <i class="ebIcon '+m((i=e&&e.item,i=null==i||i===!1?i:i.icon,i=null==i||i===!1?i:i.prefix,typeof i===p?i.apply(e):i))+"_"+m((i=e&&e.item,i=null==i||i===!1?i:i.icon,i=null==i||i===!1?i:i.name,typeof i===p?i.apply(e):i))+'" title="'+m((i=e&&e.item,i=null==i||i===!1?i:i.icon,i=null==i||i===!1?i:i.title,typeof i===p?i.apply(e):i))+'"></i>\n        </div>\n        '}function a(e,t){var i,n="";return n+='\n            <div class="ebTreeItem-labelContent ebTreeItem-label" title="'+m((i=e&&e.item,i=null==i||i===!1?i:i.label,typeof i===p?i.apply(e):i))+'"></div>\n        '}function d(e,t){var i,n="";return n+='\n            <div class="ebTreeItem-label" title="'+m((i=e&&e.item,i=null==i||i===!1?i:i.label,typeof i===p?i.apply(e):i))+'">'+m((i=e&&e.item,i=null==i||i===!1?i:i.label,typeof i===p?i.apply(e):i))+"</div>\n        "}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,e.helpers);var c,f="",u=this,p="function",m=this.escapeExpression;return f+='<li class="ebTreeItem',c=i.if.call(t,(c=t&&t.item,null==c||c===!1?c:c.children),{hash:{},inverse:u.noop,fn:u.program(1,o,s)}),(c||0===c)&&(f+=c),f+='">\n    <div class="ebTreeItem-content" tabindex="0">\n        <div class="ebTreeItem-expandButton">\n            <i class="ebIcon ebIcon_rightArrow ebIcon_interactive"></i>\n        </div>\n        ',c=i.if.call(t,(c=t&&t.item,null==c||c===!1?c:c.checkbox),{hash:{},inverse:u.noop,fn:u.program(3,r,s)}),(c||0===c)&&(f+=c),f+="\n        ",c=i.if.call(t,(c=t&&t.item,null==c||c===!1?c:c.icon),{hash:{},inverse:u.noop,fn:u.program(6,l,s)}),(c||0===c)&&(f+=c),f+="\n        ",c=i.if.call(t,(c=t&&t.item,null==c||c===!1?c:c.labelContent),{hash:{},inverse:u.program(10,d,s),fn:u.program(8,a,s)}),(c||0===c)&&(f+=c),f+="\n    </div>\n</li>"})}),define("widgets/Tree/tree/Item/ItemView",["jscore/core","template!./_item.html"],function(e,t){return e.View.extend({afterRender:function(){var e=this.getElement();this.expandBtn=e.find(".ebTreeItem-expandButton"),this.expandBtn&&(this.expandIcon=this.expandBtn.find(".ebIcon")),this.checkbox=e.find(".ebCheckbox"),this.checkboxStatus=e.find(".ebCheckbox-inputStatus"),this.contextMenuHolder=e.find(".ebTreeItem-menu"),this.itemIcon=e.find(".ebTreeItem-icon"),this.itemLabel=e.find(".ebTreeItem-label"),this.itemLabelContent=e.find(".ebTreeItem-labelContent"),this.itemContent=e.find(".ebTreeItem-content")},getTemplate:function(){return t(this.options.template)},getExpandBtn:function(){return this.expandBtn},getExpandIcon:function(){return this.expandIcon},getCheckbox:function(){return this.checkbox},getCheckboxStatus:function(){return this.checkboxStatus},getContextMenuHolder:function(){return this.contextMenuHolder},getItemIcon:function(){return this.itemIcon},getItemLabel:function(){return this.itemLabel},getItemLabelContent:function(){return this.itemLabelContent},getItemContent:function(){return this.itemContent}})}),define("widgets/Tree/tree/Item/Item",["widgets/WidgetCore","jscore/core","./ItemView","widgets/tree/Resolver","widgets/utils/keyboardUtils","jscore/ext/privateStore"],function(e,t,i,n,s,o){function r(e){var t=this.getDefinition(),i=t.checkbox;this._checked=e,i._checked=e,i._element.setProperty("checked",e),n.resolveCheckbox(t,e)}function h(){I(this).keyBoardControl={arrow_down:l.bind(this),arrow_up:a.bind(this),arrow_right:d.bind(this),arrow_left:c.bind(this),enter:u.bind(this),space:f.bind(this)}}function l(e){var t,i=this.getIndex(),n=this.getParent().getItems().length;i===n-1?this.isExpanded()?p.call(this.getItems()[0]):(t=m.call(this,i,n),p.call(t)):this.isExpanded()?p.call(this.getItems()[0]):(t=this.getParent().getItems()[++i],p.call(t)),e.preventDefault()}function a(e){var t,i=this.getIndex(),n=this.getParent().getItems().length;0===i?this.getDefinition()._parent?p.call(this.getParent()):(t=this.getParent().getItems()[n-1],t.isExpanded()?(t=g.call(t),p.call(t)):p.call(t)):this.isExpanded()?(t=this.getParent().getItems()[i-1],t.isExpanded()?(t=g.call(t),p.call(t)):p.call(t)):(t=g.call(this),p.call(t)),e.preventDefault()}function d(e){this.isExpanded()?p.call(this.getItems()[0]):this.getDefinition().children&&this.view.getExpandBtn().trigger("click"),e.preventDefault()}function c(e){this.isExpanded()?this.view.getExpandBtn().trigger("click"):this.getDefinition()._parent&&p.call(this.getParent()),e.preventDefault()}function f(e){this.view.getCheckbox()&&this.view.getCheckbox().trigger("click"),e.preventDefault()}function u(e){this.view.getExpandBtn().trigger("click"),e.preventDefault()}function p(){return this.view.getItemContent().focus(),this.select()}function m(e,t){if(this.getDefinition()._parent){var i=this.getParent().getIndex(),n=this.getParent().getParent().getItems(),s=n.length;if(i===s-1){var o=n[i];return m.call(o,i,s)}return n[++i]}if(e===t-1)return this.getParent().getItems()[0]}function g(){var e,t,i=this.getIndex();if(this.isExpanded())return e=this.getItems().length,t=this.getItems()[e-1],t.isExpanded()?g.call(t):t;var n=this.getParent().getItems()[--i];return n.isExpanded()?(e=n.getItems().length,t=n.getItems()[e-1],t.isExpanded()?g.call(t):t):n}function b(){if(!I(this).itemsLoaded){var e=I(this).definition.children;I(this).nestedTree=new this.options.Tree({items:e,eventBus:I(this).eventBus,parentItem:this}),I(this).nestedTree.attachTo(this.getElement()),I(this).itemsLoaded=!0}}function v(){I(this).definition.children&&(I(this).addedExpanderHandler||(this.view.getExpandBtn().addEventHandler("click",function(e){e&&e.originalEvent&&e.originalEvent.stopPropagation(),I(this).itemsExpanded?this.collapse():this.expand()},this),I(this).addedExpanderHandler=!0))}function x(){var e=I(this).definition.checkbox;if(e){var t=this.view.getCheckbox(),i=this.view.getCheckboxStatus();e.disabled&&t.setProperty("disabled",!0),e.checked&&t.setProperty("checked",!0),e.triple&&i.setModifier("triple"),t.setValue(e.value),e._checked=e.checked,e._element=t,e._status=i,e._triple=e.triple,Object.defineProperty(e,"checked",{get:function(){return this._checked},set:function(e){this._checked=e,this._element.setProperty("checked",this._checked)},enumerable:!0,configurable:!0}),Object.defineProperty(e,"triple",{get:function(){return this._triple},set:function(e){this._triple=e,this._triple?this._status.setModifier("triple"):this._status.removeModifier("triple")},enumerable:!0,configurable:!0}),t.addEventHandler("click",function(e){e.originalEvent.stopPropagation(),I(this).definition.checkbox.checked=this.view.getCheckbox().getProperty("checked"),n.resolveCheckbox(I(this).definition,I(this).definition.checkbox.checked),I(this).eventBus.publish("_itemchecked",this,I(this).definition.checkbox.checked)},this)}}var I=o.create();return e.extend({init:function(e){I(this).itemsLoaded=!1,I(this).itemsExpanded=!1,I(this).parentItem=e.parentItem,I(this).eventBus=e.eventBus,I(this).parentTree=e.parentTree},view:function(){return I(this).definition=this.options.item,"string"==typeof I(this).definition.icon&&(I(this).definition.icon={name:I(this).definition.icon}),I(this).definition.icon&&!I(this).definition.icon.prefix&&(I(this).definition.icon.prefix="ebIcon"),new i({template:{item:I(this).definition}})},addItem:function(e,t){void 0!==I(this).definition.children&&0!==I(this).definition.children.length||(I(this).definition.children=[],this.getElement().setModifier("expandable"),v.call(this)),void 0===t||t>=I(this).definition.children.length?I(this).definition.children.push(e):I(this).definition.children.splice(t,0,e),e._parent=this;var i;return I(this).nestedTree&&(I(this).itemsExpanded&&I(this).nestedTree.getElement().setStyle("display","none"),i=I(this).nestedTree.addItem(e,t),I(this).itemsExpanded&&I(this).nestedTree.expand()),i},removeItem:function(e){if(I(this).definition.children)for(var t=0;t<I(this).definition.children.length;t++)if(I(this).definition.children[t]===e.getDefinition()){I(this).definition.children.splice(t,1);break}I(this).nestedTree&&I(this).nestedTree.removeItem(e),0!==I(this).definition.children.length||I(this).definition.expandable||this.getElement().removeModifier("expandable")},getItems:function(){return b.call(this),I(this).nestedTree.getItems()},getItem:function(e){return this.getItems()[e]},getDefinition:function(){return I(this).definition},getParent:function(){return I(this).parentItem||I(this).parentTree},getIndex:function(){for(var e=this.getParent().getItems(),t=0;t<e.length;t++)if(e[t]===this)return t},isExpanded:function(){return I(this).itemsExpanded},expand:function(){b.call(this);var e=this.view.getExpandIcon();e.removeModifier("rightArrow"),e.setModifier("downArrow"),I(this).nestedTree&&(I(this).eventBus.publish("_itemexpand",this),I(this).nestedTree.expand()),I(this).itemsExpanded=!0},collapse:function(){var e=this.view.getExpandIcon();e.removeModifier("downArrow"),e.setModifier("rightArrow"),I(this).nestedTree&&(I(this).eventBus.publish("_itemcollapse",this),I(this).nestedTree.collapse()),I(this).itemsExpanded=!1},destroy:function(){this._destroyed||(this._destroyed=!0,I(this).eventBus.publish("_itemdestroy",this),I(this).parentTree&&I(this).parentTree.removeItem(this),t.Widget.prototype.destroy.call(this))},onViewReady:function(){I(this).definition.disabled&&this.disable(),h.call(this),I(this).definition.labelContent&&I(this).definition.labelContent instanceof t.Widget&&I(this).definition.labelContent.attachTo(this.view.getItemLabelContent()),(I(this).definition.children||I(this).definition.expandable)&&this.getElement().setModifier("expandable"),void 0!==this.options.item.icon&&void 0!==this.options.item.icon.opacity&&this.view.getItemIcon().setStyle("opacity",this.options.item.icon.opacity),v.call(this),x.call(this),I(this)._kbCtrlEvtId=s.addKeyHandler(this.view.getItemContent(),I(this).keyBoardControl),this.view.getItemContent().addEventHandler("click",this.select.bind(this))},updateLabelContent:function(e){I(this).definition.labelContent&&e.title&&this.view.getItemLabelContent().setAttribute("title",e.title),I(this).definition.labelContent&&I(this).definition.labelContent instanceof t.Widget&&e.labelContent&&e.labelContent instanceof t.Widget&&(I(this).definition.labelContent.detach(),e.labelContent.attachTo(this.view.getItemLabelContent()))},showIcon:function(){void 0!==I(this).definition.icon&&this.view.getItemIcon().setStyle("display","inline-block")},hideIcon:function(){void 0!==I(this).definition.icon&&this.view.getItemIcon().setStyle("display","none")},disable:function(){I(this).definition.checkbox&&(this.view.getCheckbox().setProperty("disabled",!0),I(this).definition.checkbox.disabled=!0)},enable:function(){I(this).definition.checkbox&&(this.view.getCheckbox().setProperty("disabled",!1),I(this).definition.checkbox.disabled=!1)},select:function(){I(this).eventBus.publish("_itemselect",this)},setCheckboxValue:function(e){r.call(this,e)}})}),define("widgets/tree/Item",["widgets/Tree/tree/Item/Item"],function(e){return e});