/* Copyright (c) Ericsson 2019 */

define("template!widgets/InfoPopup/content/_content.hbs",["jscore/handlebars/handlebars"],function(t){return t.template(function(t,e,i,n,o){function s(t,e){return'\n        <div class="ebInfoPopup-closeButton"><i class="ebIcon ebIcon_close ebIcon_interactive"></i></div>\n    '}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers);var r,c="",h=this;return c+='<div class="ebInfoPopup-content" style="position: fixed; bottom: inherit; right: inherit" data-bypassfocuslock>\n    ',r=i.if.call(e,e&&e.topRightCloseBtn,{hash:{},inverse:h.noop,fn:h.program(1,s,o)}),(r||0===r)&&(c+=r),c+='\n    <div class="ebInfoPopup-contentText eb_scrollbar"></div>\n    <div class="ebInfoPopup-arrowShadow"></div>\n    <div class="ebInfoPopup-arrowBorder"></div>\n</div>\n'})}),define("widgets/InfoPopup/content/ContentView",["jscore/core","template!./_content.hbs"],function(t,e){"use strict";return t.View.extend({getTemplate:function(){return e(this.options)},getContentText:function(){return this.getElement().find(".ebInfoPopup-contentText")},getContent:function(){return this.getElement().find(".ebInfoPopup-content")},getCloseButton:function(){return this.getElement().find(".ebInfoPopup-closeButton")},setContentText:function(e){var i=this.getContentText();i.children().forEach(function(t){t.remove()}),"string"==typeof e?i.append(t.Element.parse("<span>"+e+"</span>")):e instanceof t.Widget&&e.attachTo(i)}})}),define("widgets/InfoPopup/content/Content",["jscore/core","./ContentView"],function(t,e){"use strict";return t.Widget.extend({view:function(){return new e(this.options)}})}),define("widgets/utils/keyboardUtils",[],function(){"use strict";var t={},e={BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,ARROW_LEFT:37,ARROW_UP:38,ARROW_RIGHT:39,ARROW_DOWN:40,DELETE:46},i=function(e,i){var n,o=e.originalEvent.keyCode;if(Object.keys(i).some(function(e){if(t[e.toUpperCase()]===o)return n=i[e],!0}),n)return n(e)},n=function(t,e){if(!t||!e)throw new Error("Missing event argument");return t.addEventHandler("keydown",function(t){return i(t,e)})},o=function(t,e){e&&t.removeEventHandler(e)};return Object.keys(e).forEach(function(i){Object.defineProperty(t,i,{value:e[i],writable:!1})}),t.addKeyHandler=n,t.removeKeyHandler=o,t}),define("text!widgets/InfoPopup/_infoPopup.html",function(){return'<div class="ebInfoPopup">\n    <div class="ebInfoPopup-infoIcon" tabindex="0"><i class="ebIcon ebIcon_interactive ebIcon_medium"></i></div>\n</div>\n'}),define("widgets/InfoPopup/InfoPopupView",["jscore/core","text!./_infoPopup.html"],function(t,e){"use strict";return t.View.extend({afterRender:function(){var t=this.getElement();this._infoIcon=t.find(".ebIcon"),this._infoIconContaier=t.find(".ebInfoPopup-infoIcon")},getTemplate:function(){return e},getInfoIcon:function(){return this._infoIcon},getInfoIconContainer:function(){return this._infoIconContaier}})}),define("widgets/InfoPopup/InfoPopup",["jscore/core","widgets/WidgetCore","widgets/utils/domUtils","./InfoPopupView","widgets/utils/keyboardUtils","./content/Content","jscore/ext/privateStore","../utils/parserUtils","container/api"],function(t,e,i,n,o,s,r,c,h){"use strict";function d(){if(void 0===g(this).contentWidget){g(this).contentWidget=new s({topRightCloseBtn:g(this).topRightCloseBtn}),this.setContent(this.options.content||"");var t=g(this).contentWidget.view.getCloseButton();t&&t.addEventHandler("click",f.bind(this,void 0)),this.options.width&&g(this).contentWidget.getElement().setStyle("width",this.options.width)}}function a(){void 0!==g(this).eachFramePositioning&&(cancelAnimationFrame(g(this).eachFramePositioning),delete g(this).eachFramePositioning)}function l(){a.call(this),g(this).contentWidget&&g(this).contentWidget.getElement().removeStyle("height"),delete g(this).positionStyles,delete g(this).cornerModifier,delete g(this).iconPosition}function f(e){function i(e){if(e&&e.originalEvent){var i=t.Element.wrap(e.originalEvent.target);this.getElement().contains(i)||g(this).contentWidget.getElement().contains(i)||(n.removeEventHandler(g(this).bodyEventId.click),n.removeEventHandler(g(this).bodyEventId.touch),delete g(this).bodyEventId,f.call(this,!1))}}if(g(this).isVisible=void 0!==e?e:!g(this).isVisible,g(this).isVisible===!0&&(d.call(this),h.getEventBus().publish("infopopup:open",this)),this.trigger(g(this).isVisible?"show":"hide"),g(this).isVisible){if(g(this).contentWidget.attachTo(t.Element.wrap(document.body)),g(this).contentH=g(this).contentWidget.getElement().getProperty("offsetHeight"),!g(this).persistent){var n=t.Element.wrap(document.documentElement);g(this).bodyEventId||(g(this).bodyEventId={click:n.addEventHandler("click",i.bind(this)),touch:n.addEventHandler("touchstart",i.bind(this))})}if(p.call(this),void 0===g(this).eachFramePositioning){var o=function(){g(this).eachFramePositioning=requestAnimationFrame(o.bind(this)),p.call(this)};g(this).eachFramePositioning=requestAnimationFrame(o.bind(this))}}else void 0!==g(this).contentWidget&&(g(this).contentWidget.detach(),l.call(this))}function p(){var e,n=this.view.getInfoIcon(),o=n.getPosition(),s=g(this).iconPosition,r=g(this).positionStyles||{};e=i.isTouchZoomActive()?i.getDocumentPosition(n):o;var c=void 0===s||s.top!==e.top||s.left!==e.left,h=t.Element.wrap(document.body).contains(this.getElement()),d=void 0!==s&&!g(this).persistent&&c,a=g(this).persistent&&!h;if(a||d)return void this.setVisible(!1);g(this).iconPosition=e;var l=t.Window.getProperty("innerHeight"),f=g(this).contentWidget.getElement(),p=u.call(this,o),I=e.bottom<0,E=e.top+p.top,w={top:(I?E:Math.max(b,E))+"px",left:e.left+p.left+"px"},P=e.top,y=l-e.bottom-m,C=y>P;!C&&E<b?w.height=e.top-b-v+"px":C&&g(this).contentH>y?w.height=y-v+"px":f.removeStyle("height");var W=r.top!==w.top,x=r.height!==w.height,R=r.left!==w.left;(W||R||x)&&(f.setStyle(w),g(this).positionStyles=w)}function u(e){var i=g(this).contentWidget.getElement(),n=this.view.getInfoIcon(),o=n.getProperty("offsetHeight"),s=n.getProperty("offsetWidth"),r=g(this).contentH,c=i.getProperty("offsetWidth"),h=t.Window.getProperty("innerWidth"),d=t.Window.getProperty("innerHeight"),a=g(this).corner;if("auto"===g(this).corner){var l=e.left+c>h-6,f=e.top,p=d-e.bottom-m,u=p>=f,b=p<g(this).contentH;a=!l||!u&&b?l&&b&&!u?"bottomRight":l||!b||u?"default":"bottomLeft":"topRight"}g(this).cornerModifier!==a&&(i.setModifier("corner",a),g(this).cornerModifier=a);var E={top:0,left:0};switch(a){case"topRight":E.top+=o+v,E.left+=-c+s+I;break;case"bottomLeft":E.top+=-r-v,E.left+=-I;break;case"bottomRight":E.top+=-r-v,E.left+=-c+s+I;break;default:E.top+=o+v,E.left+=-I}return E}var g=r.create(),v=8,b=8,m=17,I=12;return e.extend({View:n,init:function(){var t=this.options;g(this).isVisible=!1,g(this).enabled=void 0===t.enabled||t.enabled,g(this).corner=void 0!==t.corner?t.corner:"auto",g(this).persistent=void 0!==t.persistent&&t.persistent,g(this).topRightCloseBtn=void 0===t.topRightCloseBtn||t.topRightCloseBtn},onViewReady:function(){var t=this.view.getInfoIcon(),e=h.getEventBus(),i=c.parseIcons(this.options.icon,"info");t.setModifier(i.name,"",i.prefix),t.addEventHandler("click",function(t){g(this).enabled&&f.call(this)}.bind(this)),this.view.getInfoIconContainer().addEventHandler("keypress",function(t){g(this).enabled&&t.originalEvent.keyCode===o.ENTER&&f.call(this)}.bind(this)),g(this).eventOpeningId=e.subscribe("infopopup:open",function(t){t!==this&&g(this).isVisible&&f.call(this)}.bind(this)),g(this).eventFlyoutOpeningId=e.subscribe("flyout:show",function(){g(this).isVisible&&f.call(this)}.bind(this)),g(this).enabled||this.disable()},onDOMAttach:function(){g(this).onDOMAttachExecuted=!0,void 0!==g(this).onDOMAttachSetVisible&&this.setVisible(g(this).onDOMAttachSetVisible)},onDestroy:function(){var t=h.getEventBus();a.call(this),t.unsubscribe("infopopup:open",g(this).eventOpeningId),t.unsubscribe("flyout:show",g(this).eventFlyoutOpeningId),g(this).contentWidget&&g(this).contentWidget.destroy()},setContent:function(t){d.call(this),g(this).contentWidget.view.setContentText(t)},setVisible:function(t){g(this).onDOMAttachExecuted?f.call(this,t):(g(this).onDOMAttachSetVisible=t,t||l.call(this))},enable:function(){g(this).enabled=!0;var t=this.view.getInfoIcon();t.removeModifier("disabled"),t.setModifier("interactive")},disable:function(){g(this).enabled=!1;var t=this.view.getInfoIcon();t.removeModifier("interactive"),t.setModifier("disabled"),this.setVisible(!1)}})}),define("widgets/InfoPopup",["widgets/InfoPopup/InfoPopup"],function(t){return t});