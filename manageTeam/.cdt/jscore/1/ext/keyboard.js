/* Copyright (c) Ericsson 2018 */

define("jscore/ext/keyboard",["jscore/core","jscore/ext/utils"],function(e,t){"use strict";var i={},n=0,r=[],s={backspace:8,tab:9,enter:13,pause:19,break:19,caps:20,esc:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,scroll:145,num:144};i.keys={shift:16,ctrl:17,alt:18},t.extend(i.keys,s),Object.freeze&&Object.freeze(i.keys);var d={shift:{},ctrl:{},alt:{},meta:{},init:function(){this.shift={binded:!1,pressed:!1},this.ctrl={binded:!1,pressed:!1},this.alt={binded:!1,pressed:!1},this.meta={binded:!1,pressed:!1}},setPressed:function(e){e.shiftKey&&(this.shift.pressed=!0),e.ctrlKey&&(this.ctrl.pressed=!0),e.altKey&&(this.alt.pressed=!0),e.metaKey&&(this.meta.pressed=!0)},setBinded:function(e){return"ctrl"===e?(this.ctrl.binded=!0,!0):"shift"===e?(this.shift.binded=!0,!0):"alt"===e?(this.alt.binded=!0,!0):"meta"===e&&(this.meta.binded=!0,!0)},check:function(){return this.ctrl.pressed===this.ctrl.binded&&this.shift.pressed===this.shift.binded&&this.alt.pressed===this.alt.binded&&this.meta.pressed===this.meta.binded}},a=function(e){var t=e;if(void 0!==e.originalEvent&&(t=e.originalEvent),void 0===t.keyCode)return!0;for(var i=String.fromCharCode(t.keyCode).toLowerCase(),n=0;n<r.length;n++){var a=r[n];d.init(),d.setPressed(t);for(var o=a.__keys.split("+"),l=0,h=0;h<o.length;h++){var f=o[h];d.setBinded(f)&&l++,f.length>1?s[f]===t.keyCode&&l++:i===f&&l++}if(l===o.length&&d.check()){var c=!1;if(a.__element?a.__element.getNative()===document.activeElement&&(c=!0):c=!0,c)return a.__callback(),t.stopPropagation(),t.preventDefault(),!1}}return!0};return i.addEventHandler=function(t,i,s){t=t.toLowerCase();var d=0;t.split("+").forEach(function(e){var t=["ctrl","alt","shift"].indexOf(e)!==-1;if(t||d++,d>1)throw new Error("Cannot have more than 1 non-modifier in combination.")}),0===r.length&&e.Window.addEventHandler("keydown",a.bind(this));var o={__id:n++,__keys:t,__callback:i,__element:s};return r.push(o),o},i.removeEventHandler=function(t){for(var i=0;i<r.length;i++){var n=r[i];if(n.__id===t.__id)return r.splice(i,1),void(0===r.length&&e.Window.removeEventHandler("keydown",a.bind(this)))}},i});