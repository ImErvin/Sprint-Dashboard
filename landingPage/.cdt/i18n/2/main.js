/* Copyright (c) Ericsson 2019 */

define("i18n/main",["require","i18n/number/language","i18n/datetime/language","i18n/utils/extObjectUtils"],function(e,n,t,r){"use strict";function i(e,n,t,r){n(["container/api"],function(n){var r=n.getConfig(),i=[];if(!r||!r.properties||!r.properties[e]&&!r.properties["*"])return void t([]);var o=r.properties["*"];if(o&&o.i18n&&o.i18n.locales)return void t(o.i18n.locales);var a=r.properties[e];return a&&a.i18n&&a.i18n.locales?void t(a.i18n.locales):void t(i)},r)}function o(e,n,t,r){n([e+"/config"],function(e){var n=e.i18n&&e.i18n.locales?e.i18n.locales:[];t(n)},r)}function a(e,n,t,r){i(e,n,function(i){i.length>0?t(i):o(e,n,t,r)},r)}function c(){try{return requirejs.s.contexts._.config}catch(e){return{}}}function s(){var e=c();void 0!==e.i18n&&void 0!==e.i18n.locale&&(u.i18n.locale=e.i18n.locale)}function l(e){return u.packages.some(function(n){return n.name===e})}var u=e.config?e.config():e.getConfig(),g={"i18n/datetime/languages":t,"i18n/number/languages":n};return{version:"1.0.1",__getNavigator:function(){return window.navigator||void 0},__getCurrentLocale:function(){return this.currentLocale},getAppSupportedLocales:function(){return u.i18n&&u.i18n.locales?r.clone(u.i18n.locales):[]},get browserLocales(){var e=this.__getNavigator();return e&&e.language?e.languages?e.languages.map(function(e){return e.toLocaleLowerCase()}):[e.language]:[]},get preferredLocale(){return u.i18n&&u.i18n.locale?u.i18n.locale:this.browserLocale},get browserLocale(){return"undefined"==typeof navigator?"root":((navigator.languages?navigator.languages[0]:navigator.language)||navigator.userLanguage||"root").toLowerCase()},get currentLocale(){var e=this.getAppSupportedLocales();if(void 0!==e&&e.length>0){var n=this.browserLocales;u.i18n&&u.i18n.locale&&n.unshift(u.i18n.locale),this._locale=this.getBestMatchingLocale(n,e)}else this._locale=this.browserLocale;return this._locale},getBestMatchingLocale:function(e,n){function t(e,n){var t=e.split("-")[0].toLowerCase(),r=!1,i=!1;return n.some(function(n){n=n.toLowerCase();var o=n.split("-")[0];return e===n?(r=n,!0):void(t===o&&i===!1&&(i=n))}),r||i}if(Array.isArray(e)){var r=!1;return e.some(function(e){var i=t(e,n);if(i)return r=i,!0}),r||n[0]}return t(e,n)||n[0]},createXhr:function(){if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;throw new Error("This browser is not supported")},get:function(e,n){var t=this.createXhr();t.open("GET",e,!0),t.addEventListener("load",function(){try{var i=JSON.parse(t.responseText);i.hasOwnProperty("get")||Object.defineProperty(i,"get",{value:function(e,n){return r.getProperties(i,e,n)}}),n(i)}catch(r){console.error("i18n: Failed to parse "+e+" as JSON. Received:\n"+t.responseText,r),n.error&&n.error(r)}}),t.addEventListener("error",function(r){console.error("i18n: Failed to load "+e+". Received:\n"+t.responseText,r),n.error&&n.error(r)}),t.send(null)},load:function(e,n,t,r){function i(r){if(e.indexOf(".json")!==-1){var i=u.i18n&&u.i18n.localesDir?u.i18n.localesDir:"locales";this.get(i+"/"+r+"/"+e,t)}else{var o=g[e];void 0!==o&&o.indexOf(r)===-1&&(r=this.getBestMatchingLocale(r,["en-us"].concat(o))),n([e+"/"+r],t,t.error)}}if(s(),r.isBuild)return t();var o=e.split("/")[0];if(void 0!==u.context&&o!==u.context&&"i18n"!==o&&"_"!==u.context){if(l(o)===!0)return a(o,n,function(e){var n=e.length>0?this.getBestMatchingLocale(this.currentLocale,e):"en-us";i.call(this,n)}.bind(this),t.error);i.call(this,"en-us")}else i.call(this,this.currentLocale)}}});